--[[
Script này dành cho executor như Delta Roblox
Chức năng: Xóa hết dữ liệu, chức năng của các script khác trên client (LocalScript).
Không thể xóa Script bên server hoặc các core script của Roblox.
]]

local protectedNames = {script.Name, "ScriptCleaner"} -- Không tự xóa bản thân

-- 1. Ngắt các event connections trong game (tự động disconnect).
local function disconnectAll(obj)
    local success, cons = pcall(getconnections, obj)
    if success and type(cons) == "table" then
        for _, v in ipairs(cons) do
            pcall(function() v:Disable() end)
            pcall(function() v:Disconnect() end)
        end
    end
end

-- 2. Dọn dẹp _G, shared, getgenv, getrenv (chỉ nên làm khi bạn muốn thật sạch)
for k in pairs(_G) do
    _G[k] = nil
end
for k in pairs(shared) do
    shared[k] = nil
end
local env = getgenv and getgenv() or getrenv and getrenv() or {}
for k in pairs(env) do
    env[k] = nil
end

-- 3. Tìm và phá hủy các LocalScript khác
local function destroyScripts(parent)
    for _, v in ipairs(parent:GetDescendants()) do
        if v:IsA("LocalScript") and not table.find(protectedNames, v.Name) then
            -- Dọn env của script nếu có thể
            pcall(function()
                setfenv(1, {})
            end)
            -- Xóa script khỏi game
            pcall(function()
                v.Disabled = true
                v:Destroy()
            end)
        end
    end
end

destroyScripts(game.Players.LocalPlayer.PlayerGui)
destroyScripts(game.Players.LocalPlayer.StarterGui)
if game.Players.LocalPlayer:FindFirstChild("Backpack") then
    destroyScripts(game.Players.LocalPlayer.Backpack)
end
if game.Players.LocalPlayer.Character then
    destroyScripts(game.Players.LocalPlayer.Character)
end

-- 4. Dọn các kết nối sự kiện phổ biến
local function cleanConnections(obj)
    disconnectAll(obj.Changed)
    disconnectAll(obj.ChildAdded)
    disconnectAll(obj.ChildRemoved)
    disconnectAll(obj.DescendantAdded)
    disconnectAll(obj.DescendantRemoving)
end

for _, s in ipairs(game.Players.LocalPlayer:GetDescendants()) do
    cleanConnections(s)
end

-- 5. Dọn các thread bất thường (executor hỗ trợ)
if getgc then
    for _, v in ipairs(getgc(true)) do
        if typeof(v) == "function" and islclosure(v) then
            -- Thử nil function (nếu không phải của Roblox)
            if not isexecutorclosure or not isexecutorclosure(v) then
                pcall(function() hookfunction(v, function() return nil end) end)
            end
        end
    end
end

-- 6. Dọn các event kết nối bên ngoài
if getconnections then
    for _, v in ipairs(getconnections(game:GetService("RunService").RenderStepped)) do
        pcall(function() v:Disable() end)
        pcall(function() v:Disconnect() end)
    end
end

-- 7. (Tùy chọn) Xóa UI dư thừa
for _, v in ipairs(game.Players.LocalPlayer.PlayerGui:GetChildren()) do
    if v:IsA("ScreenGui") and v.Name ~= "ScriptCleaner" then
        pcall(function() v:Destroy() end)
    end
end

-- 8. Thông báo đã dọn xong
game.StarterGui:SetCore("SendNotification", {
    Title = "Cleaner",
    Text = "Đã xóa sạch script khác!",
    Duration = 5
})
